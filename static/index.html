<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Eleandro Gaioski - AI Resume</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { primary: "#0ea5e9", dark: "#0f172a" } } }
    }
  </script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <style>
    body {
      transition: background-image 1.4s ease-in-out;
      background-attachment: fixed; 
      background-size: cover;
      background-position: center;
    }
    
    #messages { scrollbar-width: thin; }
    #messages::-webkit-scrollbar { width: 6px; }
    #messages::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; }
    
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
    .b1 { animation: bounce 1.4s infinite; }
    .b2 { animation: bounce 1.4s infinite 0.2s; }
    .b3 { animation: bounce 1.4s infinite 0.4s; }
    
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    .fadeIn { animation: fadeIn 0.4s ease-out; }

    /* Estilos Markdown */
    .md-content ul, .md-content ol { padding-left: 1.5rem; margin-top: 0.5rem; }
    .md-content li { margin-bottom: 0.25rem; }
    .md-content pre { background-color: #e2e8f0; padding: 0.75rem; border-radius: 0.5rem; overflow-x: auto; }
	
	.hide-content main {
		opacity: 0 !important;
		pointer-events: none;
		transition: opacity 0.4s ease; /* Adiciona a transição suave */
	}
		
	/* Caixa de Perguntas Rápidas — Scroll bonito e interno */
	.quick-questions-container {
	  height: calc(100vh - 180px);
	  background: rgba(255, 255, 255, 0.9);
	  backdrop-filter: blur(12px);
	  border-radius: 1.5rem;
	  border: 1px solid rgba(255, 255, 255, 0.5);
	  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
	  padding: 1.5rem;
	  display: flex;
	  flex-direction: column;
	  overflow: hidden; /* ← importante */
	}

	.quick-questions-header {
	  background: linear-gradient(to right, #0ea5e9, #2563eb);
	  color: white;
	  padding: 0.5rem 2rem;
	  text-align: center;
	  font-size: 1.2rem;
	  font-weight: bold;
	  border-radius: 1.5rem 1.5rem 0 0;
	  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
	  margin: -1.5rem -1.5rem 1.5rem -1.5rem;
	}

	.quick-questions-list {
	  flex: 1;
	  overflow-y: auto;
	  padding-right: 0.5rem;
	  margin-right: -0.5rem; /* compensa o padding do scroll */
	  scrollbar-width: thin;
	  scrollbar-color: rgba(100, 100, 255, 0.4) transparent;
	}

	/* Scroll bonito no Chrome/Edge */
	.quick-questions-list::-webkit-scrollbar {
	  width: 8px;
	}
	.quick-questions-list::-webkit-scrollbar-track {
	  background: transparent;
	  border-radius: 10px;
	}
	.quick-questions-list::-webkit-scrollbar-thumb {
	  background: rgba(100, 150, 255, 0.5);
	  border-radius: 10px;
	  border: 2px solid transparent;
	  background-clip: content-box;
	}
	.quick-questions-list::-webkit-scrollbar-thumb:hover {
	  background: rgba(80, 120, 255, 0.7);
	  background-clip: content-box;
	}
	
  </style>
</head>
<body class="min-h-screen flex flex-col text-gray-800">

<header class="bg-white/90 shadow-lg border-b border-white/40 z-50">
  <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col lg:flex-row items-center justify-between gap-4">
    <div class="flex items-center gap-4 w-full lg:w-auto justify-center lg:justify-start">
      <img src="/static/images/foto-perfil.jpg" alt="Eleandro Gaioski" class="w-16 h-16 rounded-full ring-4 ring-primary/30 object-cover">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold text-dark">Eleandro Gaioski</h1>
        <p class="text-base text-primary" data-t="title">Senior Data Scientist • Consultant • Agrotech IoT Specialist • Python • AI • Ex-CTO</p>
      </div>
    </div>
    
    <div class="flex flex-col sm:flex-row items-center gap-4">
      <div class="flex bg-gray-100/80 rounded-full p-1 shadow-md">
        <button onclick="setLang('en')" id="btn-en" class="px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 transition hover:bg-gray-200">
          <img src="https://flagcdn.com/16x12/us.png" alt="EN"> EN
        </button>
        <button onclick="setLang('fr')" id="btn-fr" class="px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 hover:bg-gray-200">
          <img src="https://flagcdn.com/16x12/fr.png" alt="FR"> FR
        </button>
        <button onclick="setLang('pt')" id="btn-pt" class="px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 bg-primary text-white">
          <img src="https://flagcdn.com/16x12/br.png" alt="PT"> PT
        </button>
      </div>
      
      <div class="grid grid-cols-2 gap-2 w-full sm:w-auto">
        <a href="https://linkedin.com/in/gaioski" target="_blank" class="bg-[#0077b5] hover:bg-[#005582] text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 shadow-sm"><i class="fab fa-linkedin-in"></i> LinkedIn</a>
        <a href="https://github.com/gaioski" target="_blank" class="bg-[#333] hover:bg-black text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 shadow-sm"><i class="fab fa-github"></i> GitHub</a>
        <a href="mailto:gaioski@gmail.com" class="bg-[#db4437] hover:bg-[#c53929] text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 shadow-sm"><i class="fas fa-envelope"></i> Email</a>
        <a href="https://wa.me/5541988633383" target="_blank" class="bg-[#25D366] hover:bg-[#128C7E] text-white px-4 py-2 rounded-full text-sm flex items-center justify-center gap-2 shadow-sm"><i class="fab fa-whatsapp"></i> WhatsApp</a>
      </div>
    </div>
  </div>
</header>

<main class="flex-1 max-w-7xl mx-auto w-full px-4 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
  
  <div class="lg:col-span-2 bg-white/90 rounded-3xl shadow-2xl flex flex-col border border-white/50" style="height: calc(100vh - 180px);">
    
    <div class="bg-gradient-to-r from-primary to-blue-600 text-white p-2 text-center rounded-t-3xl shadow-sm">
      <h2 class="text-lg font-bold" data-t="chat-title">Assistente Virtual</h2>
    </div>
    
    <div id="messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-transparent">
      <div class="text-center text-gray-600 italic text-sm bg-white/50 rounded-lg p-2 inline-block mx-auto shadow-sm" data-t="welcome">
        Olá! Sou o assistente virtual do Eleandro. Pergunte qualquer coisa!
      </div>
    </div>
    
    <div id="typing-indicator" class="hidden p-4">
      <div class="flex justify-start">
        <div class="bg-gray-200/90 rounded-3xl px-6 py-3 shadow-md flex items-center gap-3">
          <div class="flex space-x-2">
            <div class="w-3 h-3 bg-gray-600 rounded-full b1"></div>
            <div class="w-3 h-3 bg-gray-600 rounded-full b2"></div>
            <div class="w-3 h-3 bg-gray-600 rounded-full b3"></div>
          </div>
          <span id="typing-text" class="text-gray-700 font-medium">Pensando...</span>
        </div>
      </div>
    </div>

    <div class="p-4 bg-white/70 border-t border-gray-200/50 rounded-b-3xl">
      <form id="form" class="flex gap-3">
        <input type="text" id="input" placeholder="Digite sua pergunta..." class="flex-1 px-5 py-3 rounded-full border border-gray-300 focus:outline-none focus:ring-4 focus:ring-primary/30 text-base shadow-sm bg-white/90">
        <button type="submit" id="send-btn" class="bg-primary hover:bg-blue-700 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition transform hover:scale-105">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
        </button>
      </form>
    </div>
  </div>

	<div class="quick-questions-container">
	  <div class="quick-questions-header" data-t="quick-questions">Perguntas rápidas</div>
	  <div id="suggested-questions" class="quick-questions-list space-y-3"></div>
	</div>
	
</main>

<script>
  const translations = {
    en: { "chat-title": "Virtual Assistant", title: "Senior Data Scientist • Consultant • Agrotech IoT Specialist • Python • AI • Ex-CTO", welcome: "Hi! I'm Eleandro's virtual assistant. Ask me anything!", placeholder: "Ask your question...", "quick-questions": "Quick Questions", questions: ["Tell me about your education","What are your most recent professional experiences?","What are your main technologies?","What makes you stand out?","Have you worked with AI or LLMs?","Have you led teams or projects?","What do you do in your free time?","Do you work remotely?"] },
    pt: { "chat-title": "Assistente Virtual", title: "Cientista de Dados Sênior • Consultor • Especialista em IoT para Agrotech • Python<br>IA • Ex-CTO", welcome: "Olá! Sou o assistente virtual do Eleandro. Pergunte qualquer coisa!", placeholder: "Digite sua pergunta...", "quick-questions": "Perguntas rápidas", questions: ["Fale sobre sua formação","Conte-me sobre seus últimos trabalhos","Quais suas principais tecnologias?","Qual seu diferencial?","Já trabalhou com IA ou LLMs?","Já liderou equipes ou projetos?","O que gosta de fazer nas horas vagas?","Você trabalha remotamente?"] },
    fr: { "chat-title": "Assistant Virtuel", title: "Data Scientist Senior • Consultant • Spécialiste IoT Agrotech • Python • IA • Ex-CTO", welcome: "Bonjour! Je suis l'assistant virtuel d'Eleandro. Demandez-moi n'importe quoi!", placeholder: "Posez votre question...", "quick-questions": "Questions rapides", questions: ["Parlez-moi de votre formation","Quelles sont vos expériences professionnelles les plus récentes ?","Quelles sont vos principales technologies ?","Qu'est-ce qui vous distingue ?","Avez-vous travaillé avec l'IA ou les LLMs ?","Avez-vous dirigé des équipes ou des projets ?","Que faites-vous pendant votre temps libre ?","Travaillez-vous à distance ?"] }
  };

  const backgroundByLang = {
    'pt': '/static/images/infographic_pt.png',
    'en': '/static/images/infographic_en.png',
    'fr': '/static/images/infographic_fr.png'
  };

  let currentBackgroundType = 'infographic';

  function setInfographicBackground(lang) {
    const url = backgroundByLang[lang] || backgroundByLang['pt'];
    document.body.style.background = `
      linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
      url('${url}') 
      center/cover fixed no-repeat
    `;
    currentBackgroundType = 'infographic';
  }

  function setFluxBackground(url) {
    if (!url) {
      const lang = localStorage.getItem('lang') || 'pt';
      setInfographicBackground(lang);
      return;
    }
    // Mostra a imagem gerada
    document.body.style.background = `
      linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
      url('${url}') 
      center/cover fixed no-repeat
    `;
    currentBackgroundType = 'flux';
  }

	const body = document.body;
	const header = document.querySelector('header');
	const main = document.querySelector('main');

	// Função para adicionar/remover classe (simplificada)
	function toggleContentVisibility(hide) {
		body.classList.toggle('hide-content', hide);
	}

	// 1. Interromper o evento se começar no Header ou Main (Captura)
	document.addEventListener('mousedown', (event) => {
		// Verifica se o clique começou dentro do header OU dentro do main
		if (header.contains(event.target) || main.contains(event.target)) {
			// Impede que o evento de mousedown continue a se propagar até o body
			event.stopPropagation();
		}
	}, true); // O 'true' garante que pegamos o evento primeiro.

	// 2. Ocultar conteúdo (Listener no Body/Document)
	document.addEventListener('mousedown', (event) => {
		if (event.button === 0) { // Botão esquerdo
			// Se o evento chegou até aqui, significa que ele não foi interrompido (clique no background)
			toggleContentVisibility(true); 
		}
	});

	// 3. Mostrar conteúdo e fallback
	document.addEventListener('mouseup', () => {
		toggleContentVisibility(false);
	});
    
	document.addEventListener('mouseleave', () => {
		toggleContentVisibility(false);
	});


  // --- LÓGICA DE CHAT (ASYNC) ---
  const messages = document.getElementById('messages');
  const input      = document.getElementById('input');
  const typing     = document.getElementById('typing-indicator');
  const sendBtn    = document.getElementById('send-btn');

  function addMessage(text, isUser = false) {
    const div = document.createElement('div');
    div.className = `flex ${isUser ? 'justify-end' : 'justify-start'} fadeIn`;
    div.innerHTML = `<div class="${isUser ? 'bg-primary text-white' : 'bg-gray-100 text-gray-900'} rounded-3xl px-6 py-4 max-w-xs sm:max-w-lg shadow-md border border-black/5 md-content">
      ${isUser ? `<p>${text}</p>` : text} 
    </div>`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function createCtaButton(text) {
    const btn = document.createElement('button');
    btn.className = "bg-white/80 border border-primary text-primary hover:bg-primary hover:text-white font-medium py-2 px-4 rounded-xl text-sm transition duration-300 shadow-sm w-full sm:w-64 text-center";
    btn.textContent = text;
    btn.onclick = () => send(text);
    return btn;
  }

  function addResponse(text, cta0, cta1) {
    const html = marked.parse(text).trim();
    const div = document.createElement('div');
    div.className = 'flex justify-start fadeIn';
    div.innerHTML = `<div class="bg-gray-100 text-gray-900 rounded-3xl px-6 py-4 max-w-base sm:max-w-2xl shadow-md border border-black/5 md-content">
      ${html}
    </div>`;
    messages.appendChild(div);

    if (cta0 || cta1) {
      const cdiv = document.createElement('div');
      cdiv.className = 'flex justify-start pt-2 fadeIn';
      const wrap = document.createElement('div');
      wrap.className = 'flex flex-col sm:flex-row gap-2';
      if (cta0) wrap.appendChild(createCtaButton(cta0));
      if (cta1) wrap.appendChild(createCtaButton(cta1));
      cdiv.appendChild(wrap);
      messages.appendChild(cdiv);
    }
    messages.scrollTop = messages.scrollHeight;
  }

  async function send(question) {
    if (!question.trim()) return;
    addMessage(question, true);
    input.value = '';
    typing.classList.remove('hidden');
    sendBtn.disabled = true;

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: question})
      });
      const data = await res.json();
      
      typing.classList.add('hidden');
      addResponse(data.response || "...", data.call_action0, data.call_action1);
      
      sendBtn.disabled = false;
      input.focus();

      if (data.trigger_image) {
        console.log("Detectado gatilho para imagem. Buscando em background...");
        fetch('/generate_background', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message: question})
        })
        .then(r => r.json())
        .then(imgData => {
            if (imgData.image_url) {
                setFluxBackground(imgData.image_url);
            }
        })
        .catch(e => console.error("Erro background img:", e));
      } else {
        const lang = localStorage.getItem('lang') || 'pt';
        setInfographicBackground(lang);
      }

    } catch (e) {
      console.error(e);
      typing.classList.add('hidden');
      addResponse("Erro de conexão.");
      sendBtn.disabled = false;
    }
  }

  document.getElementById('form').addEventListener('submit', e => {
    e.preventDefault();
    send(input.value);
  });

  function setLang(lang) {
    document.documentElement.lang = lang === 'pt' ? 'pt-BR' : (lang === 'fr' ? 'fr-FR' : 'en');
    localStorage.setItem('lang', lang);

    ['en','pt','fr'].forEach(l => {
      const btn = document.getElementById(`btn-${l}`);
      const active = l === lang;
      btn.classList.toggle('bg-primary', active);
      btn.classList.toggle('text-white', active);
      btn.classList.toggle('hover:bg-gray-200', !active);
      btn.classList.toggle('text-gray-800', !active);
    });

    const t = translations[lang];
    document.querySelectorAll('[data-t]').forEach(el => {
      const k = el.dataset.t;
      if (t[k]) {
        if (k === 'title') el.innerHTML = t[k];
        else el.textContent = t[k];
      }
    });

    document.getElementById('input').placeholder = t.placeholder;
    document.getElementById('typing-text').textContent = lang==='pt' ? 'Pensando...' : (lang==='fr' ? 'Réfléchissant...' : 'Thinking...');

    const container = document.getElementById('suggested-questions');
    container.innerHTML = '';
    t.questions.forEach(q => {
      const b = document.createElement('button');
      b.className = "w-full text-left bg-white/70 hover:bg-white text-blue-900 font-medium py-3 px-5 rounded-xl border border-white/40 shadow-sm transition";
      b.textContent = q;
      b.onclick = () => send(q);
      container.appendChild(b);
    });

    if (currentBackgroundType !== 'flux') {
      setInfographicBackground(lang);
    }
  }

  setLang(localStorage.getItem('lang') || 'pt');
</script>

</body>
</html>